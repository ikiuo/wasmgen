<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8"/>
    <title>wasmgen : WebAssembly ç”¨ã‚¢ã‚»ãƒ³ãƒ–ãƒ© - ãƒ–ãƒ­ãƒƒã‚¯ã¨åˆ†å²å‘½ä»¤</title>
    <style>
    body {
      width: 840px;
      margin: auto;
      padding: 2.0em;
      border: solid 1px lightgray;
      font-family: "Meiryo";
    }
    h1, h2 {
      border-bottom: solid 1px #eceef1;
      padding-bottom: 0.2em;
    }
    table {
      border: solid 1px #e8ebee;
      border-collaspe: collaspe;
      border-spacing: 0;
    }
    th, td {
      border: solid 1px #e8ebee;
      padding: 0.5em;
    }
    code, .code {
      background-color: #f6f8fa;
      padding: 0.3em 0.4em;
      font-family: "Courier", "MS Gothic";
      font-size: 0.9em ;
      line-height: 1.5em;
    }
    pre {
      background-color: #f6f8fa;
      padding: 1em;
      font-family: "Courier", "MS Gothic";
      font-size: 0.9em ;
      line-height: 0.6em;
    }
    .left {
      text-align: left;
    }
    .center {
      text-align: center;
    }
    .right {
       text-align: right;
    }
    .vtop {
       vertical-align: top;
    }
    .vbase {
       vertical-align: baseline;
    }
    .vmiddle {
       vertical-align: middle;
    }
    .vbottom {
       vertical-align: bottom;
    }
    </style>
  </head>
  <body>
    <h1>wasmgen : WebAssembly ç”¨ã‚¢ã‚»ãƒ³ãƒ–ãƒ©<br/>ãƒ–ãƒ­ãƒƒã‚¯ã¨åˆ†å²å‘½ä»¤</h1>
    <p style="font-size: xx-large;"><b>ç›®æ¬¡</b></p>
    Â Â Â Â Â Â Â Â <a href="#index-1">ãƒ–ãƒ­ãƒƒã‚¯ã¨åˆ†å²å‘½ä»¤</a><br/>
    Â Â Â Â Â Â Â Â Â Â Â Â <a href="#index-2">ãƒ–ãƒ­ãƒƒã‚¯ã®è¨˜è¿°å½¢å¼</a><br/>
    Â Â Â Â Â Â Â Â Â Â Â Â <a href="#index-3">ãƒ–ãƒ­ãƒƒã‚¯é–‹å§‹ã®è¨˜è¿°å½¢å¼</a><br/>
    <p>&nbsp;</p>
    <h2><a name="index-1">ãƒ–ãƒ­ãƒƒã‚¯ã¨åˆ†å²å‘½ä»¤</a></h2>
    <p>åˆ†å²å‘½ä»¤ã¯ãƒ–ãƒ­ãƒƒã‚¯ã‹ã‚‰ã®è„±å‡ºã®ã¿ã§ã€åˆ†å²ã™ã‚‹ã«ã¯ãƒ–ãƒ­ãƒƒã‚¯ã®è¨˜è¿°ãŒå¿…è¦ã§ã™ã€‚</p>
    <p>&nbsp;</p>
    <h4>ãƒ–ãƒ­ãƒƒã‚¯<code>block</code>ã€œ<code>end</code></h4>
    <table>
      <tr>
        <th><code>br</code>åˆ†å²å…ˆ</th>
        <th>å‘½ä»¤</th>
        <th>ã‚ªãƒšãƒ©ãƒ³ãƒ‰</th>
        <th>å‚™è€ƒ</th>
      </tr>
      <tr>
        <td></td>
        <td><code>block</code></td>
        <td><code>&lt;blocktype&gt;</code></td>
        <td>ãƒ–ãƒ­ãƒƒã‚¯ã®é–‹å§‹</td>
      </tr>
      <tr>
        <td class="center">â†“</td>
        <td><code>ğ‘–ğ‘›ğ‘ ğ‘¡ğ‘Ÿ...</code></td>
        <td></td>
        <td>ãƒ–ãƒ­ãƒƒã‚¯å†…ã®ã‚³ãƒ¼ãƒ‰</td>
      </tr>
      <tr>
        <td class="center">âœ“</td>
        <td><code>end</code></td>
        <td></td>
        <td>ãƒ–ãƒ­ãƒƒã‚¯ã®çµ‚äº†</td>
      </tr>
    </table>
    <p>&nbsp;</p>
    <h4>ãƒ–ãƒ­ãƒƒã‚¯<code>loop</code>ã€œ<code>end</code></h4>
    <table>
      <tr>
        <th><code>br</code>åˆ†å²å…ˆ</th>
        <th>å‘½ä»¤</th>
        <th>ã‚ªãƒšãƒ©ãƒ³ãƒ‰</th>
        <th>å‚™è€ƒ</th>
      </tr>
      <tr>
        <td class="center">âœ“</td>
        <td><code>loop</code></td>
        <td><code>&lt;blocktype&gt;</code></td>
        <td>ãƒ–ãƒ­ãƒƒã‚¯ã®é–‹å§‹</td>
      </tr>
      <tr>
        <td class="center">â†‘</td>
        <td><code>ğ‘–ğ‘›ğ‘ ğ‘¡ğ‘Ÿ...</code></td>
        <td></td>
        <td>ãƒ–ãƒ­ãƒƒã‚¯å†…ã®ã‚³ãƒ¼ãƒ‰</td>
      </tr>
      <tr>
        <td></td>
        <td><code>end</code></td>
        <td></td>
        <td>ãƒ–ãƒ­ãƒƒã‚¯ã®çµ‚äº†</td>
      </tr>
    </table>
    <p>&nbsp;</p>
    <h4>ãƒ–ãƒ­ãƒƒã‚¯<code>if</code>ã€œ<code>else</code>ã€œ<code>end</code></h4>
    <table>
      <tr>
        <th colspan="2"><code>br</code>åˆ†å²å…ˆ</th>
        <th rowspan="2">å‘½ä»¤</th>
        <th rowspan="2">ã‚ªãƒšãƒ©ãƒ³ãƒ‰</th>
        <th rowspan="2">å‚™è€ƒ</th>
      </tr>
      <tr>
        <th><code>if</code></th>
        <th><code>else</code></th>
      </tr>
      <tr>
        <td></td>
        <td></td>
        <td><code>if</code></td>
        <td><code>&lt;blocktype&gt;</code></td>
        <td><code>if</code>ãƒ–ãƒ­ãƒƒã‚¯ã®é–‹å§‹</td>
      </tr>
      <tr>
        <td class="center">â†“</td>
        <td></td>
        <td><code>ğ‘–ğ‘›ğ‘ ğ‘¡ğ‘Ÿ...</code></td>
        <td></td>
        <td>ãƒ–ãƒ­ãƒƒã‚¯å†…ã®ã‚³ãƒ¼ãƒ‰</td>
      </tr>
      <tr>
        <td class="center">â†“</td>
        <td></td>
        <td><code>else</code></td>
        <td></td>
        <td><code>if</code>ãƒ–ãƒ­ãƒƒã‚¯ã®çµ‚äº†<br/><code>else</code>ãƒ–ãƒ­ãƒƒã‚¯ã®é–‹å§‹</td>
      </tr>
      <tr>
        <td class="center">â†“</td>
        <td class="center">â†“</td>
        <td><code>ğ‘–ğ‘›ğ‘ ğ‘¡ğ‘Ÿ...</code></td>
        <td></td>
        <td>ãƒ–ãƒ­ãƒƒã‚¯å†…ã®ã‚³ãƒ¼ãƒ‰</td>
      </tr>
      <tr>
        <td class="center">âœ“</td>
        <td class="center">âœ“</td>
        <td><code>end</code></td>
        <td></td>
        <td>ãƒ–ãƒ­ãƒƒã‚¯ã®çµ‚äº†</td>
      </tr>
    </table>
    <p>&nbsp;</p>
    <h3><a name="index-2">ãƒ–ãƒ­ãƒƒã‚¯ã®è¨˜è¿°å½¢å¼</a></h3>
    <table>
      <tr>
        <th>ãƒ©ãƒ™ãƒ«</th>
        <th>å‘½ä»¤</th>
        <th>ã‚ªãƒšãƒ©ãƒ³ãƒ‰</th>
        <th>å‚™è€ƒ</th>
      </tr>
      <tr>
        <td><code>ãƒ©ãƒ™ãƒ«å</code></td>
        <td><code>block</code></td>
        <td><code>&lt;blocktype&gt;</code></td>
        <td>ãƒ–ãƒ­ãƒƒã‚¯ã®é–‹å§‹</td>
      </tr>
      <tr>
        <td><code>ãƒ©ãƒ™ãƒ«å</code></td>
        <td><code>loop</code></td>
        <td><code>&lt;blocktype&gt;</code></td>
        <td>ãƒ«ãƒ¼ãƒ—ãƒ»ãƒ–ãƒ­ãƒƒã‚¯ã®é–‹å§‹</td>
      </tr>
      <tr>
        <td><code>ãƒ©ãƒ™ãƒ«å</code></td>
        <td><code>if</code></td>
        <td><code>&lt;blocktype&gt;</code></td>
        <td><code>if</code>ãƒ–ãƒ­ãƒƒã‚¯ã®é–‹å§‹<br/>ã‚¹ã‚¿ãƒƒã‚¯ä¸Šã®<code>i32</code>ãŒ<br/>å½(<code>0</code>)ãªã‚‰ã°<code>else</code>ã¸åˆ†å²</td>
      </tr>
      <tr>
        <td></td>
        <td><code>else</code></td>
        <td></td>
        <td><code>else</code>ãƒ–ãƒ­ãƒƒã‚¯ã®é–‹å§‹</td>
      </tr>
      <tr>
        <td class="vtop"><code>ãƒ©ãƒ™ãƒ«å</code></td>
        <td><code>end</code><br/><code>end.block</code><br/><code>end.loop</code><br/><code>end.if</code></td>
        <td></td>
        <td class="vtop">ãƒ–ãƒ­ãƒƒã‚¯ã¾ãŸã¯ã‚³ãƒ¼ãƒ‰ã®çµ‚ç«¯<br/>åˆ¥å end.* ã¯ãƒ–ãƒ­ãƒƒã‚¯è¨˜è¿°ç”¨ã§<br/>å¯¾ã§ãªã„å ´åˆã«è­¦å‘ŠãŒå‡ºã¾ã™</td>
      </tr>
    </table>
    <pre>ãƒ©ãƒ™ãƒ«å    block   &lt;blocktype&gt;<br/>
ãƒ©ãƒ™ãƒ«å    loop    &lt;blocktype&gt;<br/>
ãƒ©ãƒ™ãƒ«å    if      &lt;blocktype&gt;<br/>
ã€€ã€€ã€€ã€€    else<br/>
ãƒ©ãƒ™ãƒ«å    end</pre>
    <p><code>ãƒ©ãƒ™ãƒ«å</code>ã¯åˆ¶å¾¡ãƒ–ãƒ­ãƒƒã‚¯ã®<code>labelidx</code>ã«ãªã‚Šã¾ã™ã€‚</p>
    <p><code>block,loop,if</code>ã«<code>ãƒ©ãƒ™ãƒ«å</code>ãŒã‚ã‚‹å ´åˆã¯ã€<code>end</code>ã®<code>ãƒ©ãƒ™ãƒ«å</code>ã¯ç„¡è¦–ã•ã‚Œã¾ã™ã€‚<code>block,loop,if</code>ã«<code>ãƒ©ãƒ™ãƒ«å</code>ãŒãªã„å ´åˆã¯ã€<code>end</code>ã®<code>ãƒ©ãƒ™ãƒ«å</code>ãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã™ã€‚<code>ãƒ©ãƒ™ãƒ«å</code>ã¯<code>block,loop,if</code>ã‹ã‚‰<code>end</code>ã®æœŸé–“ãŒæ¤œç´¢å¯¾è±¡ã«ãªã‚‹ãŸã‚ã€<code>end</code>ã‚ˆã‚Šå¾Œã§åŒã˜è­˜åˆ¥å­ã®<code>ãƒ©ãƒ™ãƒ«å</code>ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</p>
    <p>&nbsp;</p>
    <h3><a name="index-3">ãƒ–ãƒ­ãƒƒã‚¯é–‹å§‹ã®è¨˜è¿°å½¢å¼</a></h3>
    <p><code>block,loop,if</code>ã‚’<code>&lt;instr&gt;</code>ã¨ã™ã‚‹ã¨ã€è¨˜è¿°å½¢å¼ã¯æ¬¡ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚</p>
    <table>
      <tr>
        <th>ãƒ©ãƒ™ãƒ«</th>
        <th>å‘½ä»¤</th>
        <th>ã‚ªãƒšãƒ©ãƒ³ãƒ‰<code>&lt;blocktype&gt;</code></th>
        <th>å‚™è€ƒ</th>
      </tr>
      <tr>
        <td><code>ãƒ©ãƒ™ãƒ«å</code></td>
        <td><code>&lt;instr&gt;</code></td>
        <td></td>
        <td>è¿”å€¤ãªã—ã®é–¢æ•°ç›¸å½“</td>
      </tr>
      <tr>
        <td><code>ãƒ©ãƒ™ãƒ«å</code></td>
        <td><code>&lt;instr&gt;</code></td>
        <td><code>&lt;typeidx&gt;</code></td>
        <td><code>&lt;typeidx&gt;</code>ã®é–¢æ•°å‹</td>
      </tr>
      <tr>
        <td><code>ãƒ©ãƒ™ãƒ«å</code></td>
        <td><code>&lt;instr&gt;</code></td>
        <td><code>&lt;valtype&gt;</code></td>
        <td><code>&lt;valtype&gt;</code>ãŒè¿”å€¤ã®é–¢æ•°ç›¸å½“</td>
      </tr>
      <tr>
        <td><code>ãƒ©ãƒ™ãƒ«å</code></td>
        <td><code>&lt;instr&gt;</code></td>
        <td><code>&lt;valtype&gt;,&nbsp;&lt;valtype&gt;...</code></td>
        <td><code>&lt;valtype&gt;</code>ãƒªã‚¹ãƒˆãŒè¿”å€¤ã®é–¢æ•°ç›¸å½“</td>
      </tr>
      <tr>
        <td><code>ãƒ©ãƒ™ãƒ«å</code></td>
        <td><code>&lt;instr&gt;</code></td>
        <td><code>é–¢æ•°å‹</code></td>
        <td>è¨˜è¿°ã•ã‚ŒãŸ<code>é–¢æ•°å‹</code></td>
      </tr>
    </table>
    <pre>ãƒ©ãƒ™ãƒ«å    &lt;instr&gt;<br/>
ãƒ©ãƒ™ãƒ«å    &lt;instr&gt;     &lt;typeidx&gt;<br/>
ãƒ©ãƒ™ãƒ«å    &lt;instr&gt;     &lt;valtype&gt;<br/>
ãƒ©ãƒ™ãƒ«å    &lt;instr&gt;     &lt;valtype&gt;, &lt;valtype&gt;, ...<br/>
ãƒ©ãƒ™ãƒ«å    &lt;instr&gt;     é–¢æ•°å‹</pre>
    <p><code>&lt;blocktype&gt;</code>ã¯é–‹å§‹æ™‚ã®å¼•æ•°ãƒªã‚¹ãƒˆã¨çµ‚äº†æ™‚ã®è¿”å€¤ãƒªã‚¹ãƒˆã®æƒ…å ±ã ã‹ã‚‰é–¢æ•°å‹ç›¸å½“ã«ãªã‚Šã¾ã™ã€‚ä¸‹ï¼’ã¤ã®å½¢å¼ã¯ã‚¢ã‚»ãƒ³ãƒ–ãƒ©ãŒé–¢æ•°å‹ã‚’è‡ªå‹•ç”Ÿæˆãƒ»ç™»éŒ²ã—ã¦<code>typeidx</code>ã‚’å‰²ã‚Šå½“ã¦ã¾ã™ã€‚</p>
    <p>&nbsp;</p>
    <h4>ãƒ–ãƒ­ãƒƒã‚¯ã®ä¾‹</h4>
    <pre>n           .param      i32<br/>
p           .local      i32<br/>
            block<br/>
            local.get   n<br/>
            local.tee   p<br/>
            i32.eqz<br/>
            br_if       $exit<br/>
$cont:      loop<br/>
;#          ğ‘–ğ‘›ğ‘ ğ‘¡ğ‘Ÿ...<br/>
            local.get   p<br/>
            i32.const   1<br/>
            i32.sub<br/>
            local.tee   p<br/>
            br_if       $cont<br/>
            end.loop<br/>
$exit:      end.block</pre>
    <p>&nbsp;</p>
  </body>
</html>
